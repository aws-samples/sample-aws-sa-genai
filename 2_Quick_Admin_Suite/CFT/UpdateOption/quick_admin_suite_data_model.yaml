AWSTemplateFormatVersion: '2010-09-09'
Parameters:
  CloudtrailLocation:
    Type: String
    MinLength: 1
    Description: 'Enter the location of your trail as specified in the Cloudtrail
      console, start with s3://, end with CloudTrail/. example: s3://cloudtrail-awslogs-123456789123-do-not-delete/AWSLogs/123456789123/CloudTrail/'
  StartDateParameter:
    Type: String
    MinLength: 10
    Description: Input the start date for the data in the Cloudtrail bucket in
      YYYY/MM/DD format. For example, if the earliest data in the bucket is from
      1st August 2021, use 2021/08/01

Resources:
  adminconsoledb2025:
    Type: AWS::Glue::Database
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseInput:
        Name: admin-console-2025
  groupmembership:
    Type: AWS::Glue::Table
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseName: !Ref adminconsoledb2025
      TableInput:
        Description: group and user information which is generated by the etl_job_admin_suite_assets_access glue job
        Name: group_membership
        Parameters:
          has_encrypted_data: false
          classification: csv
          areColumnsQuoted: 'false'
          typeOfData: file
          columnsOrdered: 'true'
          delimiter: ','
        StorageDescriptor:
          Columns:
            - Comment: aws account_id
              Name: account_id
              Type: string
            - Comment: quicksight namespace
              Name: namespace
              Type: string
            - Comment: quicksight group
              Name: group
              Type: string
            - Comment: quicksight user
              Name: user
              Type: string
            - Comment: email of quicksight user
              Name: email
              Type: string
            - Comment: 'role of quicksight user: admin, author, reader'
              Name: role
              Type: string
            - Comment: 'identity_type of quicksight user: IAM, quicksight'
              Name: identity_type
              Type: string
            - Comment: 'arn of user'
              Name: user_arn
              Type: string
          Compressed: false
          InputFormat: org.apache.hadoop.mapred.TextInputFormat
          Location: !Join
            - ''
            - - s3://admin-suite-
              - !Ref AWS::AccountId
              - /monitoring/quicksight/group_membership
          OutputFormat: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
          SerdeInfo:
            Parameters:
              field.delim: ','
            SerializationLibrary: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
          StoredAsSubDirectories: false
        TableType: EXTERNAL_TABLE
  objectaccess:
    Type: AWS::Glue::Table
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseName: !Ref adminconsoledb2025
      TableInput:
        Description: objects and access information which is generated by the etl_job_admin_suite_assets_access glue job
        Name: object_access
        Parameters:
          has_encrypted_data: false
          classification: csv
          areColumnsQuoted: 'false'
          typeOfData: file
          columnsOrdered: 'true'
          delimiter: ','
        StorageDescriptor:
          Columns:
            - Comment: aws account_id
              Name: account_id
              Type: string
            - Comment: aws region name
              Name: aws_region
              Type: string
            - Comment: 'quicksight object type: dashboard, dataset and etc..'
              Name: object_type
              Type: string
            - Comment: quicksight object name
              Name: object_name
              Type: string
            - Comment: quicksight object id
              Name: object_id
              Type: string
            - Comment: quicksight principal type
              Name: principal_type
              Type: string
            - Comment: quicksight principal name
              Name: principal_name
              Type: string
            - Comment: quicksight principal arn
              Name: arn
              Type: string
            - Comment: quicksight namespace
              Name: namespace
              Type: string
            - Comment: 'access permissions of quicksight objects: who can do what on a
                dashboard'
              Name: permissions
              Type: string
          Compressed: false
          InputFormat: org.apache.hadoop.mapred.TextInputFormat
          Location: !Join
            - ''
            - - s3://admin-suite-
              - !Ref AWS::AccountId
              - /monitoring/quicksight/object_access
          OutputFormat: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
          SerdeInfo:
            Parameters:
              field.delim: ','
            SerializationLibrary: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
          StoredAsSubDirectories: false
        TableType: EXTERNAL_TABLE
  folderassets:
    Type: AWS::Glue::Table
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseName: !Ref adminconsoledb2025
      TableInput:
        Description: folder assets information which is generated by the etl_job_admin_suite_folder_assets job
        Name: folder_assets
        Parameters:
          has_encrypted_data: false
          classification: csv
          areColumnsQuoted: 'false'
          typeOfData: file
          columnsOrdered: 'true'
          delimiter: ','
        StorageDescriptor:
          Columns:
            - Comment: aws region name
              Name: aws_region
              Type: string
            - Comment: folder id
              Name: folder_id
              Type: string
            - Comment: member id
              Name: member_id
              Type: string
          Compressed: false
          InputFormat: org.apache.hadoop.mapred.TextInputFormat
          Location: !Join
            - ''
            - - s3://admin-suite-
              - !Ref AWS::AccountId
              - /monitoring/quicksight/folder_assets
          OutputFormat: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
          SerdeInfo:
            Parameters:
              field.delim: ','
            SerializationLibrary: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
          StoredAsSubDirectories: false
        TableType: EXTERNAL_TABLE
  folderlk:
    Type: AWS::Glue::Table
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseName: !Ref adminconsoledb2025
      TableInput:
        Description: folder permissions information which is generated by the etl_job_admin_suite_folder_assets job
        Name: folder_lk
        Parameters:
          has_encrypted_data: false
          classification: csv
          areColumnsQuoted: 'false'
          typeOfData: file
          columnsOrdered: 'true'
          delimiter: ','
        StorageDescriptor:
          Columns:
            - Comment: aws account_id
              Name: account_id
              Type: string
            - Comment: aws region name
              Name: aws_region
              Type: string
            - Comment: object type
              Name: object_type
              Type: string
            - Comment: folder name
              Name: folder_name
              Type: string
            - Comment: folder id
              Name: folder_id
              Type: string
            - Comment: folder arn
              Name: folder_arn
              Type: string
            - Comment: principal type
              Name: principal_type
              Type: string
            - Comment: principal name
              Name: principal_name
              Type: string
            - Comment: additional info
              Name: additional_info
              Type: string
            - Comment: actions
              Name: actions
              Type: string
          Compressed: false
          InputFormat: org.apache.hadoop.mapred.TextInputFormat
          Location: !Join
            - ''
            - - s3://admin-suite-
              - !Ref AWS::AccountId
              - /monitoring/quicksight/folder_lk
          OutputFormat: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
          SerdeInfo:
            Parameters:
              field.delim: ','
            SerializationLibrary: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
          StoredAsSubDirectories: false
        TableType: EXTERNAL_TABLE
  folderpath:
    Type: AWS::Glue::Table
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseName: !Ref adminconsoledb2025
      TableInput:
        Description: folder path information which is generated by the etl_job_admin_suite_folder_assets job
        Name: folder_path
        Parameters:
          has_encrypted_data: false
          classification: csv
          areColumnsQuoted: 'false'
          typeOfData: file
          columnsOrdered: 'true'
          delimiter: ','
        StorageDescriptor:
          Columns:
            - Comment: aws region name
              Name: aws_region
              Type: string
            - Comment: folder id
              Name: folder_id
              Type: string
            - Comment: folder name
              Name: folder_name
              Type: string
            - Comment: folder path
              Name: folder_path
              Type: string
          Compressed: false
          InputFormat: org.apache.hadoop.mapred.TextInputFormat
          Location: !Join
            - ''
            - - s3://admin-suite-
              - !Ref AWS::AccountId
              - /monitoring/quicksight/folder_path
          OutputFormat: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
          SerdeInfo:
            Parameters:
              field.delim: ','
            SerializationLibrary: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
          StoredAsSubDirectories: false
        TableType: EXTERNAL_TABLE
  cloudtraillog:
    Type: AWS::Glue::Table
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseName: !Ref adminconsoledb2025
      TableInput:
        Description: cloudtrail logs
        Name: cloudtrail_logs_pp
        StorageDescriptor:
          Columns:
            - Comment: eventversion
              Name: eventversion
              Type: string
            - Comment: useridentity
              Name: useridentity
              Type: struct<type:string,principalid:string,arn:string,accountid:string,invokedby:string,accesskeyid:string,username:string,sessioncontext:struct<attributes:struct<mfaauthenticated:string,creationdate:string>,sessionissuer:struct<type:string,principalid:string,arn:string,accountid:string,username:string>>>
            - Comment: eventtime
              Name: eventtime
              Type: string
            - Comment: eventsource
              Name: eventsource
              Type: string
            - Comment: eventname
              Name: eventname
              Type: string
            - Comment: awsregion
              Name: awsregion
              Type: string
            - Comment: sourceipaddress
              Name: sourceipaddress
              Type: string
            - Comment: useragent
              Name: useragent
              Type: string
            - Comment: errorcode
              Name: errorcode
              Type: string
            - Comment: errormessage
              Name: errormessage
              Type: string
            - Comment: requestparameters
              Name: requestparameters
              Type: string
            - Comment: responseelements
              Name: responseelements
              Type: string
            - Comment: additionaleventdata
              Name: additionaleventdata
              Type: string
            - Comment: requestid
              Name: requestid
              Type: string
            - Comment: eventid
              Name: eventid
              Type: string
            - Comment: resources
              Name: resources
              Type: array<struct<arn:string,accountid:string,type:string>>
            - Comment: eventtype
              Name: eventtype
              Type: string
            - Comment: apiversion
              Name: apiversion
              Type: string
            - Comment: readonly
              Name: readonly
              Type: string
            - Comment: recipientaccountid
              Name: recipientaccountid
              Type: string
            - Comment: serviceeventdetails
              Name: serviceeventdetails
              Type: string
            - Comment: sharedeventid
              Name: sharedeventid
              Type: string
            - Comment: vpcendpointid
              Name: vpcendpointid
              Type: string
          InputFormat: com.amazon.emr.cloudtrail.CloudTrailInputFormat
          Location: !Ref CloudtrailLocation
          OutputFormat: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
          SerdeInfo:
            SerializationLibrary: com.amazon.emr.hive.serde.CloudTrailSerde
          StoredAsSubDirectories: false
        PartitionKeys:
          - Name: region
            Comment: aws_region
            Type: string
          - Name: timestamp
            Comment: timestamp
            Type: string
        Parameters:
          classification: cloudtrail
          projection.enabled: true
          projection.region.type: enum
          projection.region.values: 'us-east-1,us-east-2,us-west-1,us-west-2,eu-west-1,eu-central-1,ap-southeast-1,ap-southeast-2,ap-northeast-1,ap-northeast-2,sa-east-1'
          projection.timestamp.type: date
          projection.timestamp.format: yyyy/MM/dd
          projection.timestamp.range: !Join
            - ','
            - - !Ref StartDateParameter
              - NOW
          projection.timestamp.interval: '1'
          projection.timestamp.interval.unit: DAYS
          storage.location.template: !Join
            - ''
            - - !Ref CloudtrailLocation
              - /${region}
              - /${timestamp}
        TableType: EXTERNAL_TABLE
    Type: AWS::Glue::Table
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseName: !Ref adminconsoledb2025
      TableInput:
        Description: cloudtrail logs
        Name: cloudtrail_logs_pp
        StorageDescriptor:
          Columns:
            - Comment: eventversion
              Name: eventversion
              Type: string
            - Comment: useridentity
              Name: useridentity
              Type: struct<type:string,principalid:string,arn:string,accountid:string,invokedby:string,accesskeyid:string,username:string,sessioncontext:struct<attributes:struct<mfaauthenticated:string,creationdate:string>,sessionissuer:struct<type:string,principalid:string,arn:string,accountid:string,username:string>>>
            - Comment: eventtime
              Name: eventtime
              Type: string
            - Comment: eventsource
              Name: eventsource
              Type: string
            - Comment: eventname
              Name: eventname
              Type: string
            - Comment: awsregion
              Name: awsregion
              Type: string
            - Comment: sourceipaddress
              Name: sourceipaddress
              Type: string
            - Comment: useragent
              Name: useragent
              Type: string
            - Comment: errorcode
              Name: errorcode
              Type: string
            - Comment: errormessage
              Name: errormessage
              Type: string
            - Comment: requestparameters
              Name: requestparameters
              Type: string
            - Comment: responseelements
              Name: responseelements
              Type: string
            - Comment: additionaleventdata
              Name: additionaleventdata
              Type: string
            - Comment: requestid
              Name: requestid
              Type: string
            - Comment: eventid
              Name: eventid
              Type: string
            - Comment: resources
              Name: resources
              Type: array<struct<arn:string,accountid:string,type:string>>
            - Comment: eventtype
              Name: eventtype
              Type: string
            - Comment: apiversion
              Name: apiversion
              Type: string
            - Comment: readonly
              Name: readonly
              Type: string
            - Comment: recipientaccountid
              Name: recipientaccountid
              Type: string
            - Comment: serviceeventdetails
              Name: serviceeventdetails
              Type: string
            - Comment: sharedeventid
              Name: sharedeventid
              Type: string
            - Comment: vpcendpointid
              Name: vpcendpointid
              Type: string
          InputFormat: com.amazon.emr.cloudtrail.CloudTrailInputFormat
          Location: !Join
            - ''
            - - !Ref CloudtrailLocation
              - !Ref AWS::Region
          OutputFormat: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
          SerdeInfo:
            SerializationLibrary: com.amazon.emr.hive.serde.CloudTrailSerde
          StoredAsSubDirectories: false
        PartitionKeys:
          - Name: timestamp
            Comment: timestamp
            Type: string
        Parameters:
          classification: cloudtrail
          projection.enabled: true
          projection.timestamp.type: date
          projection.timestamp.format: yyyy/MM/dd
          projection.timestamp.range: !Join
            - ','
            - - !Ref StartDateParameter
              - NOW
          projection.timestamp.interval: '1'
          projection.timestamp.interval.unit: DAYS
          storage.location.template: !Join
            - ''
            - - !Ref CloudtrailLocation
              - !Ref AWS::Region
              - /${timestamp}
        TableType: EXTERNAL_TABLE
  datadict:
    Type: AWS::Glue::Table
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseName: !Ref adminconsoledb2025
      TableInput:
        Description: data dictionry
        Name: data_dict
        Parameters:
          classification: csv
        StorageDescriptor:
          Columns:
            - Comment: datasetname
              Name: datasetname
              Type: string
            - Comment: datasetid
              Name: datasetid
              Type: string
            - Comment: columnname
              Name: columnname
              Type: string
            - Comment: columntype
              Name: columntype
              Type: string
            - Comment: columndesc
              Name: columndesc
              Type: string
          Compressed: false
          InputFormat: org.apache.hadoop.mapred.TextInputFormat
          Location: !Join
            - ''
            - - s3://admin-suite-
              - !Ref AWS::AccountId
              - /monitoring/quicksight/data_dictionary
          OutputFormat: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
          SerdeInfo:
            Parameters:
              field.delim: ','
            SerializationLibrary: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
          StoredAsSubDirectories: false
        TableType: EXTERNAL_TABLE
  datasetsinfo:
    Type: AWS::Glue::Table
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseName: !Ref adminconsoledb2025
      TableInput:
        Description: datasets info
        Name: datasets_info
        Parameters:
          classification: csv
        StorageDescriptor:
          Columns:
            - Comment: aws_region
              Name: aws_region
              Type: string
            - Comment: dashboard_name
              Name: dashboard_name
              Type: string
            - Comment: dashboardid
              Name: dashboardid
              Type: string
            - Comment: analysis
              Name: analysis
              Type: string
            - Comment: analysis_id
              Name: analysis_id
              Type: string
            - Comment: dataset_name
              Name: dataset_name
              Type: string
            - Comment: dataset_id
              Name: dataset_id
              Type: string
            - Comment: lastupdatedtime
              Name: lastupdatedtime
              Type: string
            - Comment: data_source_name
              Name: data_source_name
              Type: string
            - Comment: data_source_id
              Name: data_source_id
              Type: string
            - Comment: catalog
              Name: catalog
              Type: string
            - Comment: sqlname/schema
              Name: sqlname/schema
              Type: string
            - Comment: sqlquery/table_name
              Name: sqlquery/table_name
              Type: string
          Compressed: false
          InputFormat: org.apache.hadoop.mapred.TextInputFormat
          Location: !Join
            - ''
            - - s3://admin-suite-
              - !Ref AWS::AccountId
              - /monitoring/quicksight/datsets_info
          OutputFormat: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
          SerdeInfo:
            Parameters:
              field.delim: '|'
            SerializationLibrary: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
          StoredAsSubDirectories: false
        TableType: EXTERNAL_TABLE
  qtopicinfo:
    Type: AWS::Glue::Table
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseName: !Ref adminconsoledb2025
      TableInput:
        Description: q topics info
        Name: q_topic_info
        Parameters:
          classification: csv
          skip.header.line.count: 1
        StorageDescriptor:
          Columns:
            - Comment: topic_id
              Name: topic_id
              Type: string
            - Comment: topic_name
              Name: topic_name
              Type: string
            - Comment: dataset_arn
              Name: dataset_arn
              Type: string
            - Comment: dataset_name
              Name: dataset_name
              Type: string
            - Comment: description
              Name: description
              Type: string
            - Comment: user_experience_version
              Name: user_experience_version
              Type: string
          Compressed: false
          InputFormat: org.apache.hadoop.mapred.TextInputFormat
          Location: !Join
            - ''
            - - s3://admin-suite-
              - !Ref AWS::AccountId
              - /monitoring/quicksight/q_topics_info
          OutputFormat: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
          SerdeInfo:
            Parameters:
              field.delim: ','
            SerializationLibrary: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
          StoredAsSubDirectories: false
        TableType: EXTERNAL_TABLE
  qobjectaccessinfo:
    Type: AWS::Glue::Table
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseName: !Ref adminconsoledb2025
      TableInput:
        Description: q object access
        Name: q_object_access
        Parameters:
          classification: csv
          skip.header.line.count: 1
        StorageDescriptor:
          Columns:
            - Comment: aws account_id
              Name: account_id
              Type: string
            - Comment: aws region name
              Name: aws_region
              Type: string
            - Comment: 'quicksight object type: dashboard, dataset and etc..'
              Name: object_type
              Type: string
            - Comment: quicksight object name
              Name: object_name
              Type: string
            - Comment: quicksight object id
              Name: object_id
              Type: string
            - Comment: quicksight principal type
              Name: principal_type
              Type: string
            - Comment: quicksight principal name
              Name: principal_name
              Type: string
            - Comment: quicksight principal arn
              Name: arn
              Type: string
            - Comment: quicksight namespace
              Name: namespace
              Type: string
            - Comment: 'access permissions of quicksight objects: who can do what on a
                Q topic'
              Name: permissions
              Type: string	  
          Compressed: false
          InputFormat: org.apache.hadoop.mapred.TextInputFormat
          Location: !Join
            - ''
            - - s3://admin-suite-
              - !Ref AWS::AccountId
              - /monitoring/quicksight/q_object_access
          OutputFormat: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
          SerdeInfo:
            Parameters:
              field.delim: ','
            SerializationLibrary: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
          StoredAsSubDirectories: false
        TableType: EXTERNAL_TABLE
  datasetsproperties:
    Type: AWS::Glue::Table
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseName: !Ref adminconsoledb2025
      TableInput:
        Description: datasets properties information which is generated by the etl_job_admin_suite_ds_properties job
        Name: datasets_properties
        Parameters:
          classification: csv
          skip.header.line.count: 1
        StorageDescriptor:
          Columns:
            - Comment: aws region name
              Name: region
              Type: string
            - Comment: dataset id
              Name: dataset_id
              Type: string
            - Comment: dataset name
              Name: name
              Type: string
            - Comment: last updated time
              Name: last_updated_time
              Type: string
            - Comment: import mode (SPICE or DIRECT_QUERY)
              Name: import_mode
              Type: string
            - Comment: consumed SPICE capacity in bytes
              Name: consumed_spice_capacity_bytes
              Type: string
            - Comment: rows ingested
              Name: rows_ingested
              Type: string
            - Comment: rows dropped
              Name: rows_dropped
              Type: string
            - Comment: refresh triggered time
              Name: refresh_triggered_time
              Type: string
            - Comment: refresh time in seconds
              Name: refresh_time_seconds
              Type: string
            - Comment: request source
              Name: request_source
              Type: string
            - Comment: request type
              Name: request_type
              Type: string
            - Comment: ingestion status
              Name: ingestion_status
              Type: string
            - Comment: error info type
              Name: error_info_type
              Type: string
            - Comment: error info message
              Name: error_info_message
              Type: string
            - Comment: principal type
              Name: principal_type
              Type: string
            - Comment: principal name
              Name: principal
              Type: string
            - Comment: additional info
              Name: additional_info
              Type: string
            - Comment: actions
              Name: actions
              Type: string
            - Comment: is file indicator
              Name: is_file
              Type: string
          Compressed: false
          InputFormat: org.apache.hadoop.mapred.TextInputFormat
          Location: !Join
            - ''
            - - s3://admin-suite-
              - !Ref AWS::AccountId
              - /monitoring/quicksight/datasets_properties
          OutputFormat: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
          SerdeInfo:
            Parameters:
              field.delim: ','
            SerializationLibrary: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
          StoredAsSubDirectories: false
        TableType: EXTERNAL_TABLE
  DatasourcePropertyTable:
    Type: AWS::Glue::Table
    Properties:
      CatalogId: !Ref AWS::AccountId
      DatabaseName: admin-console-2025
      TableInput:
        Name: datasource_property
        Description: QuickSight dataset to datasource dependency mapping
        StorageDescriptor:
          Columns:
            - Comment: AWS region
              Name: region
              Type: string
            - Comment: data source name
              Name: datasource_name
              Type: string
            - Comment: data source ID
              Name: datasource_id
              Type: string
            - Comment: dataset name
              Name: dataset_name
              Type: string
            - Comment: data source type
              Name: datasource_type
              Type: string
            - Comment: dataset ID
              Name: dataset_id
              Type: string
            - Comment: dataset last updated time
              Name: dataset_last_updated_time
              Type: string
            - Comment: dataset created time
              Name: dataset_created_time
              Type: string
          Compressed: false
          InputFormat: org.apache.hadoop.mapred.TextInputFormat
          Location: !Join
            - ''
            - - s3://admin-suite-
              - !Ref AWS::AccountId
              - /monitoring/quicksight/datasource_property
          OutputFormat: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
          SerdeInfo:
            Parameters:
              field.delim: ','
            SerializationLibrary: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
          StoredAsSubDirectories: false
        TableType: EXTERNAL_TABLE

  CrawlerCwQsDs:
    Type: AWS::Glue::Crawler
    Properties:
      Name: crawler-cw-qs-ds
      Role: !Sub arn:aws:iam::${AWS::AccountId}:role/QuickSightAdminConsole2025
      DatabaseName: admin-console-2025
      Targets:
        S3Targets:
          - Path: !Sub s3://admin-suite-${AWS::AccountId}/cloudwatch/cw-qs-ds/
      SchemaChangePolicy:
        UpdateBehavior: UPDATE_IN_DATABASE
        DeleteBehavior: DEPRECATE_IN_DATABASE
      Configuration: |
        {
          "Version": 1.0,
          "CrawlerOutput": {
            "Partitions": {"AddOrUpdateBehavior": "InheritFromTable"},
            "Tables": {"AddOrUpdateBehavior": "MergeNewColumns"}
          },
          "Grouping": {
            "TableGroupingPolicy": "CombineCompatibleSchemas"
          },
          "CreatePartitionIndex": true
        }
      RecrawlPolicy:
        RecrawlBehavior: CRAWL_EVERYTHING
  CrawlerCwQsSpice:
    Type: AWS::Glue::Crawler
    Properties:
      Name: crawler-cw-qs-spice
      Role: !Sub arn:aws:iam::${AWS::AccountId}:role/QuickSightAdminConsole2025
      DatabaseName: admin-console-2025
      Targets:
        S3Targets:
          - Path: !Sub s3://admin-suite-${AWS::AccountId}/cloudwatch/cw-qs-spice/
      SchemaChangePolicy:
        UpdateBehavior: UPDATE_IN_DATABASE
        DeleteBehavior: DEPRECATE_IN_DATABASE
      Configuration: |
        {
          "Version": 1.0,
          "CrawlerOutput": {
            "Partitions": {"AddOrUpdateBehavior": "InheritFromTable"},
            "Tables": {"AddOrUpdateBehavior": "MergeNewColumns"}
          },
          "Grouping": {
            "TableGroupingPolicy": "CombineCompatibleSchemas"
          },
          "CreatePartitionIndex": true
        }
      RecrawlPolicy:
        RecrawlBehavior: CRAWL_EVERYTHING
  CrawlerCwQsQIndex:
    Type: AWS::Glue::Crawler
    Properties:
      Name: crawler-cw-qs-qindex
      Role: !Sub arn:aws:iam::${AWS::AccountId}:role/QuickSightAdminConsole2025
      DatabaseName: admin-console-2025
      Targets:
        S3Targets:
          - Path: !Sub s3://admin-suite-${AWS::AccountId}/cloudwatch/cw-qs-qindex/
      SchemaChangePolicy:
        UpdateBehavior: UPDATE_IN_DATABASE
        DeleteBehavior: DEPRECATE_IN_DATABASE
      Configuration: |
        {
          "Version": 1.0,
          "CrawlerOutput": {
            "Partitions": {"AddOrUpdateBehavior": "InheritFromTable"},
            "Tables": {"AddOrUpdateBehavior": "MergeNewColumns"}
          },
          "Grouping": {
            "TableGroupingPolicy": "CombineCompatibleSchemas"
          },
          "CreatePartitionIndex": true
        }
      RecrawlPolicy:
        RecrawlBehavior: CRAWL_EVERYTHING
  CrawlerCwQsQAction:
    Type: AWS::Glue::Crawler
    Properties:
      Name: crawler-cw-qs-qaction
      Role: !Sub arn:aws:iam::${AWS::AccountId}:role/QuickSightAdminConsole2025
      DatabaseName: admin-console-2025
      Targets:
        S3Targets:
          - Path: !Sub s3://admin-suite-${AWS::AccountId}/cloudwatch/cw-qs-qaction/
      SchemaChangePolicy:
        UpdateBehavior: UPDATE_IN_DATABASE
        DeleteBehavior: DEPRECATE_IN_DATABASE
      Configuration: |
        {
          "Version": 1.0,
          "CrawlerOutput": {
            "Partitions": {"AddOrUpdateBehavior": "InheritFromTable"},
            "Tables": {"AddOrUpdateBehavior": "MergeNewColumns"}
          },
          "Grouping": {
            "TableGroupingPolicy": "CombineCompatibleSchemas"
          },
          "CreatePartitionIndex": true
        }
      RecrawlPolicy:
        RecrawlBehavior: CRAWL_EVERYTHING
  CrawlerCwQsDashVisual:
    Type: AWS::Glue::Crawler
    Properties:
      Name: crawler-cw-qs-dash-visual
      Role: !Sub arn:aws:iam::${AWS::AccountId}:role/QuickSightAdminConsole2025
      DatabaseName: admin-console-2025
      Targets:
        S3Targets:
          - Path: !Sub s3://admin-suite-${AWS::AccountId}/cloudwatch/cw-qs-dash-visual/
      SchemaChangePolicy:
        UpdateBehavior: UPDATE_IN_DATABASE
        DeleteBehavior: DEPRECATE_IN_DATABASE
      Configuration: |
        {
          "Version": 1.0,
          "CrawlerOutput": {
            "Partitions": {"AddOrUpdateBehavior": "InheritFromTable"},
            "Tables": {"AddOrUpdateBehavior": "MergeNewColumns"}
          },
          "Grouping": {
            "TableGroupingPolicy": "CombineCompatibleSchemas"
          },
          "CreatePartitionIndex": true
        }
      RecrawlPolicy:
        RecrawlBehavior: CRAWL_EVERYTHING
  CrawlerCwQsDsAddPart:
    Type: AWS::Glue::Crawler
    DependsOn: CwQsDsTable
    Properties:
      Name: crawler-cw-qs-ds-add-part
      Role: !Sub arn:aws:iam::${AWS::AccountId}:role/QuickSightAdminConsole2025
      DatabaseName: admin-console-2025
      Targets:
        CatalogTargets:
          - DatabaseName: admin-console-2025
            Tables:
              - !Sub cw_qs_ds_${AWS::AccountId}
      SchemaChangePolicy:
        UpdateBehavior: UPDATE_IN_DATABASE
        DeleteBehavior: LOG
      Schedule:
        ScheduleExpression: cron(0 * * * ? *)
      Configuration: |
        {
          "Version": 1.0,
          "CrawlerOutput": {
            "Partitions": {"AddOrUpdateBehavior": "InheritFromTable"},
            "Tables": {"AddOrUpdateBehavior": "MergeNewColumns"}
          }
        }
  CrawlerCwQsSpiceAddPart:
    Type: AWS::Glue::Crawler
    DependsOn: CwQsSpiceTable
    Properties:
      Name: crawler-cw-qs-spice-add-part
      Role: !Sub arn:aws:iam::${AWS::AccountId}:role/QuickSightAdminConsole2025
      DatabaseName: admin-console-2025
      Targets:
        CatalogTargets:
          - DatabaseName: admin-console-2025
            Tables:
              - !Sub cw_qs_spice_${AWS::AccountId}
      SchemaChangePolicy:
        UpdateBehavior: UPDATE_IN_DATABASE
        DeleteBehavior: LOG
      Schedule:
        ScheduleExpression: cron(0 * * * ? *)
      Configuration: |
        {
          "Version": 1.0,
          "CrawlerOutput": {
            "Partitions": {"AddOrUpdateBehavior": "InheritFromTable"},
            "Tables": {"AddOrUpdateBehavior": "MergeNewColumns"}
          }
        }
  CrawlerCwQsQIndexAddPart:
    Type: AWS::Glue::Crawler
    DependsOn: CwQsQIndexTable
    Properties:
      Name: crawler-cw-qs-qindex-add-part
      Role: !Sub arn:aws:iam::${AWS::AccountId}:role/QuickSightAdminConsole2025
      DatabaseName: admin-console-2025
      Targets:
        CatalogTargets:
          - DatabaseName: admin-console-2025
            Tables:
              - !Sub cw_qs_qindex_${AWS::AccountId}
      SchemaChangePolicy:
        UpdateBehavior: UPDATE_IN_DATABASE
        DeleteBehavior: LOG
      Schedule:
        ScheduleExpression: cron(0 * * * ? *)
      Configuration: |
        {
          "Version": 1.0,
          "CrawlerOutput": {
            "Partitions": {"AddOrUpdateBehavior": "InheritFromTable"},
            "Tables": {"AddOrUpdateBehavior": "MergeNewColumns"}
          }
        }
  CrawlerCwQsQActionAddPart:
    Type: AWS::Glue::Crawler
    DependsOn: CwQsQActionTable
    Properties:
      Name: crawler-cw-qs-qaction-add-part
      Role: !Sub arn:aws:iam::${AWS::AccountId}:role/QuickSightAdminConsole2025
      DatabaseName: admin-console-2025
      Targets:
        CatalogTargets:
          - DatabaseName: admin-console-2025
            Tables:
              - !Sub cw_qs_qaction_${AWS::AccountId}
      SchemaChangePolicy:
        UpdateBehavior: UPDATE_IN_DATABASE
        DeleteBehavior: LOG
      Schedule:
        ScheduleExpression: cron(0 * * * ? *)
      Configuration: |
        {
          "Version": 1.0,
          "CrawlerOutput": {
            "Partitions": {"AddOrUpdateBehavior": "InheritFromTable"},
            "Tables": {"AddOrUpdateBehavior": "MergeNewColumns"}
          }
        }
  CrawlerCwQsDashVisualAddPart:
    Type: AWS::Glue::Crawler
    DependsOn: CwQsDashVisualTable
    Properties:
      Name: crawler-cw-qs-dash-visual-add-part
      Role: !Sub arn:aws:iam::${AWS::AccountId}:role/QuickSightAdminConsole2025
      DatabaseName: admin-console-2025
      Targets:
        CatalogTargets:
          - DatabaseName: admin-console-2025
            Tables:
              - !Sub cw_qs_dash_visual_${AWS::AccountId}
      SchemaChangePolicy:
        UpdateBehavior: UPDATE_IN_DATABASE
        DeleteBehavior: LOG
      Schedule:
        ScheduleExpression: cron(0 * * * ? *)
      Configuration: |
        {
          "Version": 1.0,
          "CrawlerOutput": {
            "Partitions": {"AddOrUpdateBehavior": "InheritFromTable"},
            "Tables": {"AddOrUpdateBehavior": "MergeNewColumns"}
          }
        }